# Методы оптимизации

## Первая лекция

8 лаб, экзамен по билетам

### Что такое «методы оптимизации»?

**Оптимизация** — выбор наилучшей возможности из какого-то выбора альтернатив, количество которых обычно бесконечно (если конечно, то это просто перебор и там не нужны методы оптимизации).

Параметры бывают:

- контролируемые;
- неконтролируемые;
- целевые — характеризуют эффективность той или иной альтернативы.

Получается модель, которая связывает контролируемые и неконтролируемые параметры с целевыми, и эта она позволяет сравнивать эффективность альтернатив между собой.

Оптимизация начинается, когда мы рассматриваем обратную задачу оценивания альтернатив, т. е. задачу нахождения таких параметров альтернатив, при которых целевые параметры... 

По контролируемым параметрам модели целевые параметры определяются однозначно. 

Самым простым примером является линейное программирование. К «программированию» в общем виде оно не имеет отношения. Программирование здесь — это определение лучшей программы планирования производства. 

Предположим, что есть цех, который изготавливает два вида продукции: P1 и P2. При изоготовлении используются два станка S1 и S2. И каждая единица обрабатыватся сначала на одном, потом на другом. Предположим, что есть следующие ограничения: S1 не может работать более 10 часов в сутки, а S2 не более 8. При этом одна единица продукции P1 требует 1 часа работы S1 и 2 часов S2, а для P1: 2 S1 и 1 S2 соответственно. При реализации P1 мы получаем C1 руб., а при реализации P2 мы получаем C2 руб.

Обозначим через X1 планируемое количество единиц продукции P1, которое мы планируем на сутки. X2 — аналогично для P2.

Если мы найдём X1 и X2, так, чтобы прибыль была максимальна, то мы решим нашу задачу. 

Целевой параметр Z — это прибыль от реализации всей продукции. Т. о.:

Z = C1 * X1 + C2 * X2

Возьмём станки и посчитаем сколько времени нужно им для реализации плана:

X1 + 2 * X2 <= 10
2 * X1 + X2 <= 8

Кроме того, мы не можем изготовить отрицательное количество продукции, потому:

X1, X2 >= 0

Имеем целевую функцию:

Z = C1 * X1 + C2 * X2 → max, при условии:
    X1 + 2 * X2 <= 10
    2 * X1 + X2 <= 8
    X1, X2 >= 0

В самой общей форме задача линейного программирования является задачей на максимум или минимум некоторой линейной функции, при условии, что переменные этой функции подчиняются ряду ограничений, которые являются линейными равенствами или неравенствами.

Для того чтобы применить методы линейного программирования, обычно приводят задачу к одной из двух форм: к канонической или к стандартной. 

Определение: Задача линейного программирования называется имеющей **каноническую форму**, если выполнены следующие три условия:

1. Эта задача является задачей на максимум.
2. Все ограничения задачи являются равенствами.
3. Все переменные неотрицательны. 

Определение 2: Задача линейного программирования называется имеющей **стандартную форму**, если выполнены следующие три условия:

1. Эта задача является задачей на максимум.
2. Все ограничения являются неравенствами типа <=.
3. Все переменные неотрицательны.

Приведение к канонической или к стандартной форме любой задачи линейного программирования, осуществляется с помощью некоторых стандартных приёмов:

1. Если исходная задача является задачей на минимум, то вводят новую целевую функцию Z1, равную -Z, тогда исходная задача на минимум для Z становится задачей на максимум для функции Z1.
2. Пусть некоторое ограничение исходной задачи является неравенством (а нам нужна каноническая форма). Мы вводим новую переменную Xn+1, которая равна разности между правой и левой частями ограничения:

    A11 * X1 + A12 * X2 + .. + A1n * Xn <= B1
    Xn+1 = B1 - (A11 * X1 + A12 * X2 + .. + A1n * Xn)
    Xn+1 + A11 * X1 + A12 * X2 + .. + A1n * Xn = B1

Т. о. вводя дополнительную переменную в каждую из неравенств мы можем добиться того, чтобы все ограничения были равенствами. При этом в каждое неравенство вводится своя переменная.

3. Если некоторая переменная Xi не подчинена условию неотрицательности, то её представляют как разность двух неотрицательных переменных:

    Xi = Xi' - Xi'', при этом Xi', Xi'' >= 0

При приведении произвольной задачи к стандартному виду выполнения 1 и 3 условий производятся так же, как и при приведении к каноническому виду. Если же в исходной задаче некоторое ограничение было равенством, то его обычно заменяют системой двух взаимно противоположных неравенств:

Имеем: A11 * X1 + A12 * X2 + .. + A1n * Xn = B1

Система в таком случае:

    A11 * X1 + A12 * X2 + .. + A1n * Xn <= B1
    A11 * X1 + A12 * X2 + .. + A1n * Xn <= -B1 (тут не >=, т. к. в стандартной форме мы должны иметь <=)

### Общая система линейных уравнений

Ситема линейных уравнений называется **общей**, если она состоит из N уравнений с M неизвестными, причём количество уравнений и количество неизвестных могут несовпадать. То есть это уравнения вида:

    A11 * X1 + A12 * X2 + .. + A1n * Xn = B1
    A21 * X1 + A22 * X2 + .. + A2Xn * Xn = B2
    ...
    Am1 * X1 + Am2 * X2 + .. + AmXn * Xn = Bm

Выполнять операции над системой удобнее в виде расширенной матрицы. 

Две системы называются **эквивалентными**, если они имеют одно и то же множество решений. Системы приводятся к эквивалентному виду с помощью элементарных операций:

1. Перестановка местами строк расширенной матрицы
2. Умножение строки на отличное от 0 число
3. Прибавление к любой строке другой строки, умноженной на произвольное число

Определение: Система линейных уравнений называется имеющей **базисный вид**, если в её расширенной матрице среди коэффициентов при неизвестных имеется столько различных единичных столбцов, сколько ненулевых строк в этой матрице.

**Единичный столбец** — это столбец у которого на каком-то месте стоит единица, а на остальных нули. 

Два единичных столбца называются различными, если единицы у них стоят на разных местах.

Неизвестные, отвечающие единичным столбцам, называются базисными, а остальные — свободными. Базисные легко выразить через свободные, перенеся свободные в противоположную часть.

Если система приведена к базисному виду, то можно записать её общее решение, если свободным переменным придавать произвольное значение (C1, C2, etc).

### Метод Гаусса-Жордана для приведения системы линейных уравнений к базисному виду

Этот метод позволяет привести любую систему линейных уравнений к базисному виду, или выяснить что она несовместна. 

Метод состоит из ряда шагов:

1. Выполняем следующий алгоритм, пока система не приведётся к базисному виду, при каждой его итерации выбирая новый разрешающий элемент:
    1. Среди коэффициентов при неизвестных отличное от 0 число. Это число называется разрешающим элементом шага.
    2. Строка разрешающего элемента делится на него. Полученная в результате строка называется ведущей строкой шага.
    3. Остальные строки преобразуются с помощью ведущей строки, путём прибавления к каждой строке ведущей строки, умноженной на специально подобранное число. Число выбирается так, чтобы в столбце разрешающего элемента в преобразованной строке стоял 0. После преобразования всех строк в матрице появляется единичный столбец.

Особые случаи метода:

1. Может быть такое, что на очередном шаге появится нулевая строка (0 0 0 .. 0 | 0). Такую строку можно отбросить.
2. Может быть такое, что строка будет нулевой, а свободный член — нет (0 0 0 .. 0 | !0). Система, содержащая такое уравнение, несовместна.

Рассмотрим такую систему:

    2 * X1 + 3 * X2 - X3 = 4
    X1 - 4 * X2 + 5 * X3 = 2

Получим матрицу:

    2   3   -1  |   4
    1  -4    5  |   2

Выберем элемент 2,1 как разрещающий. Т. к. это 1, то не нужно делить строку на элемент. Умножим её на -2 и прибавим к строке 1. Получим:

    0  11  -11  |   0
    1  -4   5   |   2

Выберем элемент 1,2 как разрешающий. Разделим на него (11) строку 1:

    0   1  -1   |   0
    1  -4   4   |   2

Умножим строку 1 на 4 и сложим со строкой 2:

    0   1  -1   |   0
    1   0   1   |   2

Вернувшись к системе получаем уравнения:

    X2 - X3 = 0
    X1 + X3 = 2

Выразим базисные через сводобные:
    
    X2 = -X3
    X1 = 2 - X3

Общее решение получим заменив X3 на C:

    X2 = -C
    X1 = 2 - C

Т. о. решение: (2 - C, C, C) (т. е. трока чисел X1, X2, X3).

### Операция замещения

Это переход от одного базисного вида к другому. Причём, некоторая базисная переменная Xi становится свободной, а была базисной, а некоторая свободная Xj становится базисной.

При операции замещения рассматривается единичный столбец базисной переменной X1 и выбирается строка с 1 в этом столбце. В выбранной строке берётся коэффициент Xj, и если он не 0, то его выбирают в качестве разрешающего для шага метода Гаусса-Жордана. В результате этого шага переменная Xi становится свободной, а свободная Xj — базисной.

Например:

    X1 + 2 * X3 = 5
    X2 + 4 * X3 = 10

    1   0   2   |   5
    0   1   4   |   10

Имеем базисные X1 и X2. Заменим X2 на X3. Для этого выберем в качестве разрешающего элемента 2,3, разделим всю строку 2 на его значение (4):

    1   0   2   |   5
    0  .25  1   |  2.5

Затем умножаем строку 2 на -2 и складываем со строкой 1:

    1 -.5   0   |   0
    0  .25  1   |  2.5

### Практика

_Задача 1_

Имеем таблицу использования ресурсов для изготовления конфет:

                |   Расход на 1 тонну   | Общее кол-во сырья
    Виды сырья  |   A   |   B   |   C   |
    Сах. песок  |  .8   |  .5   |  .6   |   800
    Патока      |  .4   |  .4   |  .3   |   600
    Фрукт. пюре |   —   |  .1   |  .1   |   120
    Прибыль с 1т|  108  |  112  |  126  |

X1 — планируемое количество карамели A, которое надо выпустить
X2 — планируемое количество карамели B, которое надо выпустить
X3 — планируемое количество карамели C, которое надо выпустить

Нам нужно максимизировать прибыль. Получим функцию:

    Z = 108 * X1 + 112 * X2 + 126 * X3 → max

Также получим следующие ограничения:
    
    .8 * X1 + .5 * X2 + .6 * X3 <= 800
    .4 * X1 + .4 * X2 + .3 * X3 <= 600
              .1 * X2 + .1 * X3 <= 120
    X1, X2, X3 >= 0

Имеем задачу в стандартном виде. Приведём её к каноническому виду. Прибавим к левой части каждого уравнения свою переменную, которая является неотрицательной (алгоритм выше):

    .8 * X1 + .5 * X2 + .6 * X3 + X4            = 800
    .4 * X1 + .4 * X2 + .3 * X3      + X5       = 600
              .1 * X2 + .1 * X3           + X6  = 120
    X1..X6 >= 0

_Задача 2_

     Z = -2 * X1 - X2 + X3 → min
     2 * X1 -     X2 +  6 * X3 <= 12
     3 * X1 - 5 * X2 - 12 * X3 = 14
    -3 * X1 + 6 * X2 -  4 * X3 <= 18
     X1..X3 >= 0

Приведём к каноническому виду:

     Z1 = -Z = 2 * X1 + X2 - X3 → max
     2 * X1 -     X2 +  6 * X3 + X4 = 12
     3 * X1 - 5 * X2 - 12 * X3      = 14
    -3 * X1 + 6 * X2 -  4 * X3 + X5 = 18
     X1..X5 >= 0

_Задача 3_

     Z = 2 * X1 - 5 * X2 + 3 * X3 → min
        -X1 +     X2 +     X3 >= 12
         X1 + 5 * X2 - 6 * X3 <= 16
     3 * X1 +     X2 +     X3 >= 18
     X1, X2 >= 0

Т. к. X3 не подчинена условию неотрицательности, получим:

    X3 = X3' - X3''

Приведём к каноническому виду:

    Z1 = -Z = -2 * X1 + 5 * X2 - 3 * X3 → max
        -X1 +     X2 +     (X3' - X3'') + X4 = 12
         X1 + 5 * X2 - 6 * (X3' - X3'') + X5 = 16
     3 * X1 +     X2 +     (X3' - X3'') + X6 = 18
     X1, X2, X3', X3'', X4..X6 >= 0

_Задача 4_

    X1 - 2 * X2 + 3 * X3 + 4 * X4 = 1
    4 * X1 - 7 * X2 + 2 * X3 + X4 = 3
    3 * X1 - 5 * X2 - X3 - 3 * X4 = 2

Выпишем расширенную матрицу системы:

    1  -2   3   4   |   1
    4  -7   2   1   |   3
    3  -5  -1  -3   |   2

Выберем элемент 1,1 как разрешающий. Умножим его строку на -4 и сложим со строкой 2, затем умножим на -3 и сложим со строкой 3:

    1  -2   3   4   |   1
    0   1  -10 -15  |  -1
    0   1  -10 -15  |  -1

Т. к. 2 и 3 строка одинаковые, вычеркнем одну из них:

    1  -2   3   4   |   1
    0   1  -10 -15  |  -1

Выберем разрешающим элементом 2,2, умножим его строку на 2 и сложим со строкой 1:

    1   0  -17 -26  |  -1
    0   1  -10 -15  |  -1

Базисными переменными являются X1 и X2 (судя по единицам в столбцах). Выразим базисные переменные через свободные:

    X1 = 17 * X3 + 26 * X4 - 1
    X2 = 10 * X3 + 15 * X4 - 1

Выпишем общее решение. Пусть X3 будет C1, а X4 — C2. Получаем решение: (17 * C1 + 26 * C2 - 1; 10 * C1 + 16 * C2 - 1; C1; C2).

_Задача 5_

Привести к базисному виду и записать общее решение:

    X1 + 4 * X2 - 2 * X3 + 3 * X5 = 2
    2 * X1 + 9 * X2 - X3 - 4 * X4 = 5
    X1 + 5 * X2 + X3 - 4 * X4 + 3 * X5 = 3

    1   4  -2   0   3   |   2
    2   9  -1  -4   0   |   5
    1   5   1  -4   3   |   3

1,1: 

    1   4  -2   0   3   |   2
    0   1   3  -4  -6   |   1
    0   1   3  -4   0   |   1

2,1:

    1   0  -14 -16 -21  |  -2
    0   1   3  -4  -6   |   1
    0   0   0   0   6   |   0

3,5:

    1   0  -14 -16  0   |  -2
    0   1   3  -4   0   |   1
    0   0   0   0   1   |   0

Базисные переменные:

    X1 = -2 + 14 * X3 + 16 * X4
    X2 = 1 - 3 * X3 + 4 * X4
    X5 = 0

Пусть X3 = C1, X4 = C2, тогда общее решение: (-2 + 14 * C1 + 16 * C2; 1 - 3 * C1 + 4 * C2; C1; C2; 0).

Литература:
    - Брусенцев, Петрашёв, Рязанов, «Исследование операций и теории игр», учебное пособие. 
    - Брусенцев, Брусенцева, «Метод. указания по выполнению лаб. работ по исследованию операций и теории игр.»

## Вторая лекция

### Графическое истолкование задачи линейного программирования в стандартной форме в случае двух переменных

Рассматриваем задачу, имеющую следующий вид:

    Z = C0 + C1X1 + C2X2 → max
    A11X1 + A12X2 <= B1
    A21X1 + A22X2 <= B2
    ...
    Am1X1 + Am2X2 <= Bm

[рис. 1]

Найдём множество точек на плоскости, координаты которых удовлетворяют системе ограничений.

Рассмотрим неравенство: 
    
    A1X1 + A2X2 <= B

Нужно заменить неравенство равенством:

    A1X1 + A2X2 = B

И получить уравнение прямой. Для точек этой прямой удовлетворяется равенство. Прямая разрежет плоскость на две части. В одной из них удовлетворяется наше неравенство, в другой — противоположное.

[рис. 1]

Для того чтобы определить, какая из областей удовлетворяет неравенству, можно подставить, например, начало координат в неравенство. Если оно удовлетворяет ему, значит нужна именно эта часть.

Т. о. можно проверить каждое неравенство, в итоге все системе будут удовлетворять точки, принадлежащие одновременно всем плоскостям. Т. е. принадлежащее теоретико-.. множеству этих плоскостей. Кроме того, поскольку переменные неотрицательны, нужно взять ту часть этого пересечения, которая лежит в первой четверти.

Рассмотрим для примера следующую систему:

    2X1 + X2 <= 10
    X1 + 2X2 <= 8
    X1, X2 >= 0

Заменим неравенство равенством:

    2X1 + X2 = 10
    X1 + 2X2 = 8

И построим прямые для них (подставляя 0 вместо X1 и X2, например).

По алгоритму выше определим необходимые части плоскости и получим многоугольник OABC, который удовлетворяет нашей системе.

[рис. 2]

Целевая же функция истолковывается линией уровня. Приравняем целевую функцию к какому-то произвольному значению:

    C0 + C1X1 + C2X2 = C

Очевидно, что это будет тоже прямая, т. к. это уравнение первого порядка. Если увеличивать константу C, то мы будем получать новые прямые, но с тем же самым угловым коэф., т. к. параллельные друг другу. А двигаться она будет в направлении градиента линии уровня.

**Градиент** — это вектор, состоящий из частных производных по X1 и X2: grad = {C1, C2}. Он указывает направление скорейшего..

Для примера возьмём:

    Z = X1 + X2

Пусть 

    X1 + X2 = -2

Построим эту прямую (просто для примера) на рис. 3. grad = {1, 1}

Точка первого касания с плоскостью определения — это точка минимума, а точка последнего касания — максимума.

Для нашего примера решим систему:

    2X1 + X2 = 10
    X1 + 2X2 = 8

    X2 = 10 - 2X1
    X1 + 2 * (10 - 2X1) = 8
    -3X1 = -12
    X1 = 4
    X2 = 2

Многоугольник допустимых значений называется **допустимым многоугольником**.

Задача линейного программирования может не иметь решения в двух случаях:

1. Допустимый многоугольник может быть пустым, тогда говорят, что задача недопустима.
2. Целевая функция может быть неограничена на области допустимых значений.

### Симплекс-метод

Применяется только для канонической формы. Для применения симплекс-метода в чистом виде нужно привести задачу к особой форме.

Базисный вид системы уравнений называется допустимым, если свободные члены в нём неотрицательны. Допустимый базисный вид — это когда столбец свободных членов состоит из неотрицательных чисел.

Решение системы уравнений называется базисным , если оно отвечает некоторому базисному виду системы. Причём свободные переменные в этом базисном виде положены равными нулю. Базисные переменные равны свободным членам. Если соответствующий базисный вид является допустимым, то соответствующее решение называется опорным.

Если рассмотреть задачу линейного программирования в канонической форме, то её система ограничений является системой уравнений, которую можно привести к различным базисным видам, часть из которых будут допустимыми. Каждому допустимому базисному виду будет отвечать опорное решение, т. о. системе ограничений задачи в канонической форме можно сопоставить конечное число опорных решений.

**Фундаментальная теорема симплекс-метода**: Среди всех точек максимума задачи линейного программирования в канонической форме есть хотя бы одно опорное решение её системы ограничений.

    B1 → B2 → .. → BS
    Z(B1) <= Z(B2) <= .. <= Z(BS)

Поскольку опорных решений конечное число, то мы в конечном итоге придём в точку максимума.

Для работы с симплекс-методом система должна быть подготовлена:

1. Система должна быть приведена к базисному виду.
2. Из целевой функции должны быть исключены базисные переменные.

После такой подготовки задачи может быть составлена симплекс-таблица, с помощью которой и будут проводиться вычисления.

    Z = Y0 + Yr+1Xr+1 + .. + YnXn → max (Y здесь — это коэфф. (это ваще гамма, а не игрек))
    X1 + A1,r+1 * Xr+1 + .. + A1nXn = B1
    X2 + A2,r+1 * Xr+1 + .. + A2nXn = B2
    X3 + A3,r+1 * Xr+1 + .. + A3nXn = B3
    ...
    Xr + Ar,r+1 * Xr+1 + .. + ArnXn = Br
    Xi >= 0 (i=1,n)

Получаем таблицу:

    Базис. пер.     Своб. чл.   X1  X2  ..  Xr  Xr+1   ..   Xr  
    X1                  B1      1   0       0   Ar+1        Ar
    X2                  B2      0   1       0   Ar+1        Ar
    ..                  ..      ..      
    Xn                  Bn      0   0       1   Ar+1        Ar
    Z                   Y0      0   0       0   -Yr+1       -Yr

### Порядок работы с симплекс-таблицей

Переход от одного решения с другому осуществляется путём перехода от одной симплекс-таблицы к другой. Алгоритм следующий:

1. Просматривается последняя строка симплекс-таблицы. Если все оценки свободных переменных неотрицательны (-Yj >= 0), то данная таблица является последней и по ней можно прочесть решение задачи.
2. Если найдётся хотя бы одна оценка строго отрицательная (-Yj <= 0), то следует просмотреть столбец над этой отрицательной оценкой. И в этом столбце выбрать строго положительные числа. Если таковых не окажется, то задача не имеет решения по причине неограниченности целевой функции на области допустимых значений. 
3. Для каждого из выбранных положительных чисел находится отношение этого числа соответствующего свободного члена к этому числу (Bi / Ai,j). Из этих отношений выбирается минимальное (min(Bi / Ai,j)). Минимальному элементу отвечает Ai,j. Он показывает, что базисного..
4. С помощью выбранного элемента преходим к следующей симплекс-таблице. Для этого первоначально рассматривается пустая таблица с той же горизонтальной шапкой, но в вертикальной шапке вместо базисной переменной Xi пишется Xj.
5. Строка разрешающего элемента делится на него и записвается в ту же таблицу. В остальные строки новой таблицы записывается результат преобразования старых строк с помощью вписа.. Преобразование других строк происходит так же, как и в методе Гаусса-Жордана. После заполнения второй таблицы в строке разрешающего элемента должны стоять нули, кроме него (он == 1).
6. 

### Практика
